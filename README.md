# ergodic_test_app

A Flutter (version 3.38.4) application pre-wired with Firebase (Android config included).

> Assumptions
> - Flutter stable channel (recommended minimum: 3.10.0). Newer stable versions are fine.
> - You're on Windows and will use PowerShell (commands below are PowerShell-ready).
> - This repository contains Android Firebase config and generated options: `android/app/google-services.json` and `lib/firebase_options.dart`.


## Quick checklist (do these in order)
1. Install Flutter SDK and Android tooling (Android Studio or SDK + command line tools).
2. Install Node.js and Firebase CLI (if you will run/deploy Functions).
3. Run `flutter doctor` and resolve any issues.
4. From repo root: `flutter pub get`.
5. Start an emulator or connect a device.
6. Run the app: `flutter run -d <device-id>` or `flutter run -d chrome` for web.
7. For Cloud Functions: `cd functions && npm install` then use the emulator or `firebase deploy`.


## Repository map (important files)
- `pubspec.yaml` — Dart/Flutter dependencies.
- `lib/main.dart` — Application entrypoint.
- `lib/firebase_options.dart` — Firebase configuration (generated by FlutterFire CLI).
- `android/app/google-services.json` — Android Firebase config (present in repo).
- `functions/` — Node.js Cloud Functions (contains `index.js` and `package.json`).
- `test/widget_test.dart` — Example widget test.


## Prerequisites
- Flutter SDK (install from https://docs.flutter.dev/get-started/install). Recommended: stable channel, >= 3.10.0.
- Android Studio (recommended) or Android SDK + platform tools.
- Java JDK (Temurin/OpenJDK 11 or 17 recommended).
- Node.js + npm (for Firebase Functions and Firebase CLI).
- Firebase CLI: `npm install -g firebase-tools` (optional but required for emulators and deploy).
- (macOS only) Xcode for iOS simulator/device.


## Step-by-step setup (Windows, PowerShell)

1) Clone the repo (if you haven't already)

```powershell
git clone <repo-url>
cd ergodic_test_app
```

2) Verify Flutter & environment

```powershell
flutter doctor
```

Resolve any issues reported by `flutter doctor`. On Windows you frequently need to accept Android licenses:

```powershell
flutter doctor --android-licenses
```

3) Install Dart/Flutter dependencies

```powershell
flutter pub get
```

4) Android SDK path (optional)

Android Studio will usually create `android/local.properties`. If you need to create one manually, add your SDK path (do NOT commit this file):

```
sdk.dir=C:\Users\<YourUser>\AppData\Local\Android\Sdk
```

5) Firebase configuration

This repository already contains `android/app/google-services.json` and a generated `lib/firebase_options.dart`. If you are switching Firebase projects or those files are missing:

- Install FlutterFire CLI and configure (generates `lib/firebase_options.dart`):

```powershell
dart pub global activate flutterfire_cli
flutterfire configure --project <PROJECT_ID>
```

- For Android, download `google-services.json` from the Firebase Console and place it at `android/app/google-services.json`.

6) Start an Android emulator or connect a device

```powershell
# List emulators
flutter emulators
# Launch an emulator (replace <emulator-id> with ID from previous command)
flutter emulators --launch <emulator-id>
# Or list devices
flutter devices
```

7) Run the app (Android or web)

```powershell
# Default (first connected device/emulator)
flutter run
# Force Android
flutter run -d android
# Run on Chrome (web)
flutter run -d chrome
```

8) Build release artifacts

```powershell
# Android APK
flutter build apk --release
# Web
flutter build web --release
```


## Firebase Functions (folder: `functions/`)

1) Install dependencies and run locally

```powershell
cd functions
npm install
# Start functions emulator (requires firebase-tools)
firebase emulators:start --only functions
```

Add or update Functions runtime config (one-time or when changing values)

```powershell
# Set the gemini key (replace with your key). This writes the value to the project's functions config.
firebase functions:config:set gemini.key="your_key"
```

# View current config
```powershell
firebase functions:config:get
```

# Using config with the local emulator
```powershell
# Pull the live config to a local runtime file used by the emulator
firebase functions:config:get > .runtimeconfig.json
firebase emulators:start --only functions
```

Note: Do NOT commit `.runtimeconfig.json` to source control. Treat keys like this as secrets and manage them via environment variables or secret managers in CI/CD.

If `functions/package.json` defines a local serve script (for example `npm run serve`), you can run that instead:

```powershell
npm run serve
```

2) Deploy functions

```powershell
# Login and select project
firebase login
firebase use --add
# Deploy only functions
firebase deploy --only functions
```


## Running tests

```powershell
# Dart / Flutter tests
flutter test
# If functions have Node tests
cd functions
npm test
```


## Useful commands (PowerShell-ready)

```powershell
# Install deps
flutter pub get
cd functions; npm install

# Run app
flutter run
flutter run -d chrome

# Build
flutter build apk --release
flutter build web --release

# Tests
flutter test
cd functions; npm test

# Firebase
npm install -g firebase-tools
firebase login
firebase emulators:start
firebase deploy --only functions
```


## Troubleshooting

- flutter doctor shows missing Android licenses:

```powershell
flutter doctor --android-licenses
```

- Gradle/Kotlin issues: try cleaning and re-getting packages

```powershell
flutter clean
flutter pub get
# Also from android directory
cd android; .\gradlew clean
```

- Emulator not appearing: ensure SDK and platform tools installed and restart adb

```powershell
adb kill-server; adb start-server
```

- Port conflicts for Firebase emulator: stop the conflicting service or edit `firebase.json` to change ports.

- Missing `google-services.json` / `GoogleService-Info.plist`: download from Firebase Console and place into the appropriate platform folder.


## Security & secrets
- Do NOT commit production service account keys or other secrets.
- Use environment variables or secret stores for CI.


## Next steps / suggestions
- Add `CONTRIBUTING.md` that covers code style and PR process.
- Add a GitHub Actions workflow to run `flutter analyze`, `flutter test`, and build matrix for Android/web.
- Optional: Add a PowerShell setup script to automate local onboarding.


## Contributors
- (Add names and contacts here)


## License
- Add a `LICENSE` file if you plan to publish this repository.


---

If you want, I can also:
- Commit this README into the repo (already applied).
- Add a `CONTRIBUTING.md` and a simple GitHub Actions workflow.
- Create a small PowerShell script to automate setup steps.

Tell me which of those you'd like next.
